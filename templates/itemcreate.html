<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Listing</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h2 class="text-center">Create a New Listing</h2>
                <form id="listingForm" method="POST">
                    <div class="form-group">
                        <label for="title">Item Title</label>
                        <input type="text" class="form-control" id="title" name="title" placeholder="Enter item title" required>
                    </div>
                    <div class="form-group">
                        <label for="description">Item Description</label>
                        <textarea class="form-control" id="description" name="description" rows="3" placeholder="Enter item description" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="price">Price ($)</label>
                        <input type="number" step="0.01" class="form-control" id="price" name="price" placeholder="Enter item price" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">Submit Listing</button>
                </form>

                <script>
                    document.getElementById("listingForm").addEventListener("submit", function(event) {
                        event.preventDefault();

                        const title = document.getElementById('title').value;
                        const description = document.getElementById('description').value;
                        const price = document.getElementById('price').value;

                        // Prepare form data to send to FastAPI
                        const formData = {
                            title: title,
                            description: description,
                            price: parseFloat(price),
                            user_id: 1 // Assuming user_id is 1 for now (you should replace this with actual user data)
                        };

                        // Send listing data to FastAPI
                        fetch('http://127.0.0.1:8000/listings', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(formData)
                        })
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to submit listing');
                            }
                            return response.json();
                        })
                        .then(data => {
                            alert('Listing created successfully!');
                            console.log('Listing created:', data);
                            window.location.href = '/items';  // Redirect to the list of items (you can customize this)
                        })
                        .catch(error => {
                            console.error('Error submitting listing:', error);
                            alert('Error creating listing. Please try again.');
                        });
                    });
                </script>
            </div>
        </div>
    </div>
</body>
</html>